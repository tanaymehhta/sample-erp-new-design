import{c as k,j as e,m as i,r as h,A as F,u as z,X as O,d as U,H as Q,E as B}from"./index-8150de43.js";import{c as E,L as W,S as J,A as X,u as Y}from"./useDeals-1421468c.js";import{D as Z}from"./download-e791cd17.js";import{C as _}from"./calendar-5685a690.js";const K=k("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ee=k("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),V=k("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),A=k("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),$=k("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),te=k("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),M=k("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),se={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"};function ae({size:t="md",text:y,className:o}){return e.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},className:E("flex items-center justify-center space-x-2",o),children:[e.jsx(W,{className:E("animate-spin text-primary-600",se[t])}),y&&e.jsx("span",{className:"text-gray-600 text-sm",children:y})]})}function G({deal:t,onEdit:y,onDelete:o,className:j=""}){const[v,a]=h.useState(!1),[x,u]=h.useState(!1),p=()=>e.jsxs("div",{className:`relative ${j}`,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[e.jsx(F,{children:v&&e.jsxs(i.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},exit:{x:20,opacity:0},transition:{duration:.15,ease:"easeOut"},className:"flex items-center gap-1",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),y(t)},className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors duration-150 hover:scale-105 active:scale-95",title:"Edit Deal",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),o(t)},className:"p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors duration-150 hover:scale-105 active:scale-95",title:"Delete Deal",children:e.jsx(M,{className:"w-4 h-4"})})]})}),e.jsx(F,{children:!v&&e.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex items-center justify-center",children:e.jsx(V,{className:"w-4 h-4 text-gray-300"})})})]}),b=()=>e.jsxs("div",{className:"relative",children:[e.jsx(i.button,{onClick:c=>{c.stopPropagation(),u(!x)},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",whileTap:{scale:.95},children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx(F,{children:x&&e.jsxs(e.Fragment,{children:[e.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-10",onClick:()=>u(!1)}),e.jsx(i.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.15,ease:"easeOut"},className:"absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-20 min-w-[120px]",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:c=>{c.stopPropagation(),u(!1),y(t)},className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors duration-150",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),u(!1),o(t)},className:"w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-600 transition-colors duration-150",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Delete"]})]})})]})})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(p,{})}),e.jsx("div",{className:"lg:hidden",children:e.jsx(b,{})})]})}function re({deal:t,isOpen:y,onClose:o,onSaved:j}){const v=z(),[a,x]=h.useState({date:"",saleParty:"",quantitySold:"",saleRate:"",deliveryTerms:"delivered",productCode:"",grade:"",company:"",specificGrade:"",saleSource:"new",purchaseParty:"",purchaseQuantity:"",purchaseRate:"",saleComments:"",purchaseComments:"",finalComments:"",warehouse:""}),[u,p]=h.useState({}),[b,c]=h.useState(!1),[C,f]=h.useState(!1),[S,d]=h.useState(!1);h.useEffect(()=>{if(t){const r={date:t.date,saleParty:t.saleParty,quantitySold:t.quantitySold.toString(),saleRate:t.saleRate.toString(),deliveryTerms:t.deliveryTerms,productCode:t.productCode,grade:t.grade||"",company:t.company||"",specificGrade:t.specificGrade||"",saleSource:t.saleSource,purchaseParty:t.purchaseParty,purchaseQuantity:t.purchaseQuantity.toString(),purchaseRate:t.purchaseRate.toString(),saleComments:t.saleComments||"",purchaseComments:t.purchaseComments||"",finalComments:t.finalComments||"",warehouse:t.warehouse||""};x(r),d(!1),p({}),f(!1)}},[t]);const n=(r,m)=>{x(w=>({...w,[r]:m})),d(!0),f(!1),u[r]&&p(w=>({...w,[r]:""}))},P=()=>{const r={};return a.date||(r.date="Date is required"),a.saleParty.trim()||(r.saleParty="Sale party is required"),(!a.quantitySold||parseFloat(a.quantitySold)<=0)&&(r.quantitySold="Valid quantity is required"),(!a.saleRate||parseFloat(a.saleRate)<=0)&&(r.saleRate="Valid sale rate is required"),a.productCode.trim()||(r.productCode="Product code is required"),a.purchaseParty.trim()||(r.purchaseParty="Purchase party is required"),(!a.purchaseQuantity||parseFloat(a.purchaseQuantity)<=0)&&(r.purchaseQuantity="Valid purchase quantity is required"),(!a.purchaseRate||parseFloat(a.purchaseRate)<=0)&&(r.purchaseRate="Valid purchase rate is required"),p(r),Object.keys(r).length===0},H=async()=>{if(!(!t||!P())){c(!0);try{const r={date:a.date,saleParty:a.saleParty.trim(),quantitySold:parseFloat(a.quantitySold),saleRate:parseFloat(a.saleRate),deliveryTerms:a.deliveryTerms,productCode:a.productCode.trim(),grade:a.grade.trim()||void 0,company:a.company.trim()||void 0,specificGrade:a.specificGrade.trim()||void 0,saleSource:a.saleSource,purchaseParty:a.purchaseParty.trim(),purchaseQuantity:parseFloat(a.purchaseQuantity),purchaseRate:parseFloat(a.purchaseRate),saleComments:a.saleComments.trim()||void 0,purchaseComments:a.purchaseComments.trim()||void 0,finalComments:a.finalComments.trim()||void 0,warehouse:a.warehouse.trim()||void 0},m=await v.updateDeal(t.id,r);m.success&&m.data&&(f(!0),d(!1),j==null||j(m.data),setTimeout(()=>{o()},1500))}catch(r){console.error("Failed to update deal:",r)}finally{c(!1)}}},I=()=>{if(t){const r={date:t.date,saleParty:t.saleParty,quantitySold:t.quantitySold.toString(),saleRate:t.saleRate.toString(),deliveryTerms:t.deliveryTerms,productCode:t.productCode,grade:t.grade||"",company:t.company||"",specificGrade:t.specificGrade||"",saleSource:t.saleSource,purchaseParty:t.purchaseParty,purchaseQuantity:t.purchaseQuantity.toString(),purchaseRate:t.purchaseRate.toString(),saleComments:t.saleComments||"",purchaseComments:t.purchaseComments||"",finalComments:t.finalComments||"",warehouse:t.warehouse||""};x(r),d(!1),p({}),f(!1)}},g=({label:r,field:m,type:w="text",required:T=!1,className:s=""})=>e.jsxs("div",{className:s,children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r," ",T&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:w,value:a[m],onChange:l=>n(m,l.target.value),className:`input-field ${u[m]?"border-red-300 focus:border-red-500 focus:ring-red-500":""}`}),u[m]&&e.jsxs("div",{className:"flex items-center mt-1 text-sm text-red-600",children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),u[m]]})]}),R=({label:r,field:m,options:w,required:T=!1,className:s=""})=>e.jsxs("div",{className:s,children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r," ",T&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:a[m],onChange:l=>n(m,l.target.value),className:`input-field ${u[m]?"border-red-300 focus:border-red-500 focus:ring-red-500":""}`,children:w.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]});return!t||!y?null:e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:o}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-4xl bg-white rounded-xl shadow-xl",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Deal"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Deal #",t.id.slice(-8)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[S&&!C&&e.jsx("div",{className:"px-3 py-1 bg-orange-100 text-orange-700 text-sm rounded-full",children:"Unsaved changes"}),C&&e.jsxs("div",{className:"flex items-center px-3 py-1 bg-green-100 text-green-700 text-sm rounded-full",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Saved!"]}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:e.jsx(O,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:"Sale Information"}),e.jsx(g,{label:"Date",field:"date",type:"date",required:!0}),e.jsx(g,{label:"Sale Party",field:"saleParty",required:!0}),e.jsx(g,{label:"Quantity Sold (kg)",field:"quantitySold",type:"number",required:!0}),e.jsx(g,{label:"Sale Rate (â‚¹)",field:"saleRate",type:"number",required:!0}),e.jsx(R,{label:"Delivery Terms",field:"deliveryTerms",options:[{value:"delivered",label:"Delivered"},{value:"pickup",label:"Pickup"}],required:!0}),e.jsx(R,{label:"Sale Source",field:"saleSource",options:[{value:"new",label:"New Purchase"},{value:"inventory",label:"From Inventory"}],required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sale Comments"}),e.jsx("textarea",{value:a.saleComments,onChange:r=>n("saleComments",r.target.value),className:"input-field",rows:3})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:"Purchase Information"}),e.jsx(g,{label:"Purchase Party",field:"purchaseParty",required:!0}),e.jsx(g,{label:"Purchase Quantity (kg)",field:"purchaseQuantity",type:"number",required:!0}),e.jsx(g,{label:"Purchase Rate (â‚¹)",field:"purchaseRate",type:"number",required:!0}),e.jsx(g,{label:"Warehouse",field:"warehouse"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Comments"}),e.jsx("textarea",{value:a.purchaseComments,onChange:r=>n("purchaseComments",r.target.value),className:"input-field",rows:3})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:"Product Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(g,{label:"Product Code",field:"productCode",required:!0}),e.jsx(g,{label:"Grade",field:"grade"}),e.jsx(g,{label:"Company",field:"company"}),e.jsx(g,{label:"Specific Grade",field:"specificGrade"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Final Comments"}),e.jsx("textarea",{value:a.finalComments,onChange:r=>n("finalComments",r.target.value),className:"input-field",rows:3})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:[e.jsxs("button",{onClick:I,disabled:!S||b,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Reset"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:o,className:"btn-secondary",children:"Cancel"}),e.jsxs("button",{onClick:H,disabled:!S||b||C,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[b?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:b?"Saving...":C?"Saved!":"Save Changes"})]})]})]})]})})]})}function ie({deal:t,isOpen:y,onClose:o,onDeleted:j}){const v=z(),[a,x]=h.useState("confirm"),[u,p]=h.useState(5),b=d=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(d),c=async()=>{if(t){x("deleting");try{if((await v.deleteDeal(t.id)).success){x("success"),j==null||j(t.id);let n=5;p(n);const P=setInterval(()=>{n-=1,p(n),n<=0&&(clearInterval(P),o(),setTimeout(()=>{x("confirm"),p(5)},300))},1e3);return P}}catch(d){console.error("Failed to delete deal:",d),x("confirm")}}},C=async()=>{t&&(x("deleting"),setTimeout(()=>{x("confirm"),p(5),o()},1e3))},f=()=>{x("confirm"),p(5),o()};if(!t)return null;const S=t.quantitySold*t.saleRate;return e.jsx(F,{children:y&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:a==="confirm"?f:void 0}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsx(i.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30},className:"w-full max-w-md bg-white rounded-xl shadow-xl",onClick:d=>d.stopPropagation(),children:e.jsxs(F,{mode:"wait",children:[a==="confirm"&&e.jsxs(i.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(i.div,{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",whileHover:{rotate:-10,scale:1.1},transition:{type:"spring",stiffness:300},children:e.jsx(M,{className:"w-6 h-6 text-red-600"})}),e.jsx(i.button,{onClick:f,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",whileHover:{scale:1.1},whileTap:{scale:.9},children:e.jsx(O,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Deal?"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This action cannot be undone. This will permanently delete the deal and remove it from your records."}),e.jsxs(i.div,{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",whileHover:{scale:1.02},transition:{type:"spring",stiffness:300},children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.saleParty}),e.jsx("p",{className:"text-sm text-gray-600",children:t.date})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:b(S)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.quantitySold.toLocaleString()," kg"]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Product:"}),e.jsx("span",{className:"font-medium text-gray-900",children:t.productCode})]})]}),e.jsxs(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex items-start space-x-2 mt-4 p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx(U,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Warning"}),e.jsx("p",{className:"text-sm text-red-700",children:"This will also affect inventory calculations and reporting data."})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(i.button,{onClick:f,className:"flex-1 btn-secondary",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Cancel"}),e.jsx(i.button,{onClick:c,className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors font-medium",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Delete Deal"})]})]},"confirm"),a==="deleting"&&e.jsxs(i.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"p-6 text-center",children:[e.jsx(i.div,{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(M,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Deleting Deal..."}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we remove the deal from your records."})]},"deleting"),a==="success"&&e.jsxs(i.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"p-6 text-center",children:[e.jsx(i.div,{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:25},children:e.jsx(i.div,{initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.5,delay:.2},children:e.jsx("svg",{className:"w-8 h-8 text-green-600",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Deal Deleted"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The deal has been successfully removed from your records."}),e.jsxs(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-blue-50 rounded-lg p-4 border border-blue-200 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Changed your mind?"})]}),e.jsx(i.button,{onClick:C,className:"text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Undo Delete"})]}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 bg-blue-200 rounded-full h-1",children:e.jsx(i.div,{className:"h-1 bg-blue-600 rounded-full",initial:{width:"100%"},animate:{width:"0%"},transition:{duration:5,ease:"linear"}})}),e.jsxs("span",{className:"text-xs text-blue-700 font-mono",children:[u,"s"]})]})]}),e.jsx(i.button,{onClick:f,className:"btn-secondary",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Close"})]},"success")]})})})]})})}function le({}){const[t,y]=h.useState({}),[o,j]=h.useState(""),[v,a]=h.useState(!1),[x,u]=h.useState(null),[p,b]=h.useState(null),{deals:c,loading:C,error:f,fetchDeals:S,refreshDeals:d,pagination:n,goToPage:P,nextPage:H,prevPage:I}=Y();h.useEffect(()=>{console.log("ðŸš€ Setting up auto-refresh for deals history");const s=setInterval(()=>{console.log("ðŸ”„ Auto-refreshing deals history..."),d()},3e4);return()=>{console.log("ðŸ›‘ Clearing auto-refresh interval"),clearInterval(s)}},[d]),h.useEffect(()=>{const s=setTimeout(()=>{const l={...t};o&&(l.saleParty=o),S(l,1)},300);return()=>clearTimeout(s)},[t,o,S]);const g=async()=>{try{console.log("Exporting deals...",c);const s=JSON.stringify(c,null,2),l=new Blob([s],{type:"application/json"}),N=URL.createObjectURL(l),q=document.createElement("a");q.href=N;const D=new Date,L=`${D.getDate().toString().padStart(2,"0")}-${(D.getMonth()+1).toString().padStart(2,"0")}-${D.getFullYear()}`;q.download=`deals-export-${L}.json`,q.click(),URL.revokeObjectURL(N)}catch(s){console.error("Export failed:",s)}},R=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),r=s=>{u(s)},m=s=>{b(s)},w=()=>{d()},T=()=>{d()};return f?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx(Q,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Failed to load deals"}),e.jsx("p",{className:"text-gray-600 mb-4",children:f.message}),e.jsx("button",{onClick:d,className:"btn-primary",children:"Try Again"})]}):e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx(Q,{className:"w-8 h-8 mr-3 text-primary-600"}),"Deals History"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"View and manage all trading transactions"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(i.button,{onClick:()=>a(!v),className:E("btn-secondary flex items-center space-x-2",v&&"bg-primary-100 text-primary-700"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Filter"})]}),e.jsxs(i.button,{onClick:g,disabled:c.length===0,className:"btn-primary flex items-center space-x-2 disabled:opacity-50",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})]})]}),v&&e.jsxs(i.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:t.dateFrom||"",onChange:s=>y(l=>({...l,dateFrom:s.target.value})),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:t.dateTo||"",onChange:s=>y(l=>({...l,dateTo:s.target.value})),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Terms"}),e.jsxs("select",{value:t.deliveryTerms||"",onChange:s=>y(l=>({...l,deliveryTerms:s.target.value===""?void 0:s.target.value})),className:"input-field",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"pickup",children:"Pickup"})]})]})]}),e.jsx("div",{className:"flex justify-end mt-4 space-x-2",children:e.jsx("button",{onClick:()=>y({}),className:"btn-secondary",children:"Clear Filters"})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search deals by customer, product, or date...",value:o,onChange:s=>j(s.target.value),className:"input-field pl-10"})]}),e.jsx(i.button,{onClick:d,className:"btn-secondary",whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsx(_,{className:"w-4 h-4"})})]}),C?e.jsx("div",{className:"text-center py-12",children:e.jsx(ae,{size:"lg",text:"Loading deals..."})}):c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx(Q,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No deals found"}),e.jsx("p",{className:"text-gray-600",children:o||Object.keys(t).length>0?"No deals match your search criteria.":"Start by registering your first deal to see history here."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block overflow-auto",style:{maxHeight:"600px"},children:e.jsxs("table",{className:"w-full",style:{minWidth:"1200px"},children:[e.jsx("thead",{className:"sticky top-0 bg-white",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",style:{width:"60px"},children:"Sr.No"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",style:{width:"120px",whiteSpace:"nowrap"},children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",style:{width:"180px"},children:"Sale Party"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",style:{width:"120px"},children:"Quantity Sold"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",style:{width:"100px"},children:"Sale Rate"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",style:{width:"150px"},children:"Product"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",style:{width:"180px"},children:"Purchase Party"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",style:{width:"140px"},children:"Quantity Purchased"}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",style:{width:"120px"},children:"Purchase Rate"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",style:{width:"100px"},children:"Actions"})]})}),e.jsx("tbody",{children:c.map((s,l)=>e.jsxs(i.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:l*.05},className:"border-b border-gray-100 hover:bg-gray-50 transition-colors duration-150",children:[e.jsx("td",{className:"py-4 px-4 text-sm font-medium text-gray-700",children:l+1}),e.jsx("td",{className:"py-4 px-4 text-sm text-gray-900",style:{whiteSpace:"nowrap"},children:s.date}),e.jsx("td",{className:"py-4 px-4 text-sm font-medium text-gray-900",children:s.saleParty}),e.jsxs("td",{className:"py-4 px-4 text-sm text-gray-900 text-right",children:[s.quantitySold.toLocaleString()," kg"]}),e.jsxs("td",{className:"py-4 px-4 text-sm text-gray-900 text-right",children:["â‚¹",s.saleRate.toLocaleString()]}),e.jsx("td",{className:"py-4 px-4 text-sm text-gray-600",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.productCode}),e.jsx("div",{className:"text-xs text-gray-500",children:s.grade})]})}),e.jsx("td",{className:"py-4 px-4 text-sm font-medium text-gray-900",children:s.purchaseParty}),e.jsxs("td",{className:"py-4 px-4 text-sm text-gray-900 text-right",children:[s.purchaseQuantity.toLocaleString()," kg"]}),e.jsxs("td",{className:"py-4 px-4 text-sm text-gray-900 text-right",children:["â‚¹",s.purchaseRate.toLocaleString()]}),e.jsx("td",{className:"py-4 px-4 text-center",children:e.jsx(G,{deal:s,onEdit:r,onDelete:m})})]},s.id))})]})}),e.jsx("div",{className:"lg:hidden space-y-4",children:c.map((s,l)=>e.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:l*.03},className:"bg-gray-50 rounded-xl p-4 border border-gray-200 hover:bg-white hover:border-gray-300 hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:l+1}),e.jsx("h3",{className:"font-medium text-gray-900",children:s.saleParty})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.date})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-gray-900",children:R(s.quantitySold*s.saleRate)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.quantitySold," kg Ã— â‚¹",s.saleRate]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:s.productCode}),e.jsx("p",{className:"text-xs text-gray-500",children:s.grade})]}),e.jsx(G,{deal:s,onEdit:r,onDelete:m})]})]},s.id))}),e.jsxs("div",{className:"mt-6 flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("span",{children:["Showing ",(n.page-1)*n.limit+1," to ",Math.min(n.page*n.limit,n.total)," of ",n.total," deals"]}),c.length>0&&e.jsxs("span",{children:["Total Value: ",R(c.reduce((s,l)=>s+l.quantitySold*l.saleRate,0))]})]}),n.totalPages>1&&e.jsx("div",{className:"mt-6 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-1 bg-white border border-gray-200 rounded-lg p-1 shadow-sm",children:[e.jsx("button",{onClick:I,disabled:n.page<=1,className:"px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 disabled:opacity-30 disabled:cursor-not-allowed",children:"â†"}),Array.from({length:Math.min(n.totalPages,10)},(s,l)=>{let N;if(n.totalPages<=10)N=l+1;else{const q=n.page,D=Math.max(1,q-4),L=Math.min(n.totalPages,D+9);if(N=D+l,N>L)return null}return e.jsx("button",{onClick:()=>P(N),className:E("px-3 py-2 text-sm font-medium rounded-md min-w-[40px]",N===n.page?"bg-blue-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"),children:N},N)}),e.jsx("button",{onClick:H,disabled:n.page>=n.totalPages,className:"px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-700 disabled:opacity-30 disabled:cursor-not-allowed",children:"â†’"})]})})]})]}),e.jsx(re,{deal:x,isOpen:!!x,onClose:()=>u(null),onSaved:w}),e.jsx(ie,{deal:p,isOpen:!!p,onClose:()=>b(null),onDeleted:T})]})}function me(){return e.jsx(B,{children:e.jsx(le,{})})}export{me as default};
