import{c as v,r as j,i as w,j as e,A as E,m as N,h as S,P as b}from"./index-8150de43.js";import{C as I}from"./chevron-down-d9920b0a.js";import{C as P,D as C}from"./dollar-sign-5b5dfaa5.js";import{C as A}from"./calendar-5685a690.js";import{U as V}from"./user-af0a8cfc.js";import{P as T}from"./plus-e1fa3a4d.js";import{T as D}from"./trending-up-6210fd84.js";const q=v("Boxes",[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]]),L=v("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]),z=v("Grid",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"3",y2:"21",key:"13tij5"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}]]),Q=v("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),R=v("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]),M=v("Package2",[["path",{d:"M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z",key:"1ront0"}],["path",{d:"m3 9 2.45-4.9A2 2 0 0 1 7.24 3h9.52a2 2 0 0 1 1.8 1.1L21 9",key:"19h2x1"}],["path",{d:"M12 3v6",key:"1holv5"}]]);function $(){const[t,s]=j.useState([]),[i,n]=j.useState(!0),[l,y]=j.useState(null),o=async()=>{try{n(!0),y(null);const r=await w.getAllInventory();r.success&&r.data?s(r.data):y("Failed to fetch inventory")}catch(r){y(r instanceof Error?r.message:"Unknown error"),console.error("Error fetching inventory:",r)}finally{n(!1)}},h=async r=>{try{const a=await w.createInventoryItem(r);if(a.success)return await o(),a;throw new Error(a.error||"Failed to create inventory item")}catch(a){throw a}},g=async(r,a)=>{try{const x=await w.updateInventoryItem(r,a);if(x.success)return await o(),x;throw new Error(x.error||"Failed to update inventory item")}catch(x){throw x}},d=async r=>{try{const a=await w.deleteInventoryItem(r);if(a.success)return await o(),a;throw new Error(a.error||"Failed to delete inventory item")}catch(a){throw a}};j.useEffect(()=>{o()},[]);const m={totalItems:t.length,totalQuantity:t.reduce((r,a)=>r+a.quantity,0),totalValue:t.reduce((r,a)=>r+a.quantity*a.rate,0),topProducts:Object.entries(t.reduce((r,a)=>{const x=`${a.productCode} - ${a.grade}`;return r[x]=(r[x]||0)+a.quantity,r},{})).sort(([,r],[,a])=>a-r).slice(0,5).map(([r,a])=>({product:r,quantity:a}))};return{inventory:t,summary:m,loading:i,error:l,refetch:o,createInventoryItem:h,updateInventoryItem:g,deleteInventoryItem:d}}function G(t){const s=new Map;t.forEach(n=>{const l=`${n.productCode}|${n.grade}|${n.company}|${n.specificGrade}`;s.has(l)||s.set(l,[]),s.get(l).push(n)});const i=[];return s.forEach((n,l)=>{const y=n.sort((c,p)=>new Date(p.createdAt).getTime()-new Date(c.createdAt).getTime()),o=n.reduce((c,p)=>c+p.quantity,0),h=n.reduce((c,p)=>c+p.quantity*p.rate,0),g=o>0?h/o:0,m=n.map(c=>{const p=c.dateAdded||c.createdAt,u=new Date(p);return isNaN(u.getTime())?new Date:u}).filter(c=>!isNaN(c.getTime())),r=m.length>0?new Date(Math.min(...m.map(c=>c.getTime()))).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],a=m.length>0?new Date(Math.max(...m.map(c=>c.getTime()))).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],x=y[0];i.push({productKey:l,productCode:x.productCode,grade:x.grade,company:x.company,specificGrade:x.specificGrade,totalQuantity:o,totalValue:h,averageRate:g,purchaseCount:n.length,purchases:y,firstPurchaseDate:r,lastPurchaseDate:a})}),i.sort((n,l)=>l.totalValue-n.totalValue)}function U(t){return{totalUniqueProducts:t.length,totalItems:t.reduce((s,i)=>s+i.purchaseCount,0),totalQuantity:t.reduce((s,i)=>s+i.totalQuantity,0),totalValue:t.reduce((s,i)=>s+i.totalValue,0),topProducts:t.slice(0,5).map(s=>({product:`${s.productCode} - ${s.grade}`,quantity:s.totalQuantity,value:s.totalValue}))}}function O(){const{inventory:t,loading:s,error:i,refetch:n,createInventoryItem:l,updateInventoryItem:y,deleteInventoryItem:o}=$(),[h,g]=j.useState(new Set),d=j.useMemo(()=>G(t),[t]),m=j.useMemo(()=>U(d),[d]),r=u=>{g(k=>{const f=new Set(k);return f.has(u)?f.delete(u):f.add(u),f})},a=u=>h.has(u),x=()=>{const u=d.map(k=>k.productKey);g(new Set(u))},c=()=>{g(new Set)},p={expandedCount:h.size,totalCount:d.length,isAllExpanded:h.size===d.length,isNoneExpanded:h.size===0};return{rawInventory:t,groupedInventory:d,groupedSummary:m,loading:s,error:i,expandedItems:h,toggleExpansion:r,isExpanded:a,expandAll:x,collapseAll:c,expansionStats:p,refetch:n,createInventoryItem:l,updateInventoryItem:y,deleteInventoryItem:o}}function F({groupedItem:t,isExpanded:s,onToggleExpand:i}){return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`
          hover:bg-gray-50 cursor-pointer border-b border-gray-200 transition-all duration-200
          ${s?"bg-blue-50 hover:bg-blue-100":""}
        `,onClick:i,children:[e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[s?e.jsx(I,{className:"w-4 h-4 text-blue-500 transition-transform duration-200"}):e.jsx(P,{className:"w-4 h-4 text-gray-400 transition-transform duration-200 hover:text-blue-500"}),e.jsx("span",{className:"font-semibold",children:t.productCode}),t.purchaseCount>1&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:[t.purchaseCount," batches"]})]})}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500 w-24",children:e.jsx("div",{className:"truncate",children:t.grade})}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500 w-12",children:e.jsx("div",{className:"truncate",children:t.company})}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900 font-medium",children:e.jsxs("div",{className:"truncate max-w-[100px]",children:[t.totalQuantity.toLocaleString(),"kg"]})}),e.jsxs("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900",children:[e.jsxs("div",{className:"truncate max-w-[80px]",children:["₹",Math.round(t.averageRate),"/kg"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"avg rate"})]}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900 font-medium",children:e.jsxs("div",{className:"truncate max-w-[120px]",children:["₹",t.totalValue.toLocaleString()]})}),e.jsx("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500",children:t.purchaseCount>1?"Multiple suppliers":t.purchases[0].purchaseParty}),e.jsxs("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500",children:[t.lastPurchaseDate,t.purchaseCount>1&&e.jsx("div",{className:"text-xs text-gray-400",children:"latest"})]})]}),e.jsx(E,{children:s&&e.jsx(N.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx("td",{colSpan:8,className:"px-0 py-0",children:e.jsx(N.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{duration:.4,ease:"easeInOut",type:"spring",stiffness:300,damping:30},className:"overflow-hidden bg-gradient-to-r from-gray-50 to-blue-50",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Purchase History (",t.purchaseCount," ",t.purchaseCount===1?"batch":"batches",")"]})}),e.jsx("div",{className:"space-y-3",children:t.purchases.map((n,l)=>e.jsx(N.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1,transition:{delay:l*.1,duration:.3,ease:"easeOut"}},exit:{opacity:0,y:-10,scale:.95,transition:{delay:(t.purchases.length-1-l)*.05,duration:.2,ease:"easeIn"}},children:e.jsx(B,{purchase:n,index:l+1})},n.id))})]})})})})})]})}function B({purchase:t}){const s=t.quantity*t.rate;return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Purchase Date"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.dateAdded})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(M,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Quantity"}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:[t.quantity.toLocaleString(),"kg"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Rate"}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:["₹",t.rate,"/kg"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Supplier"}),e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:t.purchaseParty})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Batch ID: ",t.id.slice(-8)]}),e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:["Total Value: ₹",s.toLocaleString()]})]})]})}function _(){const{groupedInventory:t,groupedSummary:s,loading:i,error:n,refetch:l,toggleExpansion:y,isExpanded:o,expandAll:h,collapseAll:g,expansionStats:d}=O();return i?e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(S,{className:"w-8 h-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-3 text-lg text-gray-600",children:"Loading inventory..."})]})}):n?e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{className:"h-5 w-5 text-red-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error loading inventory"}),e.jsx("p",{className:"mt-1 text-sm text-red-700",children:n}),e.jsx("button",{onClick:l,className:"mt-2 text-sm bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded-md",children:"Try Again"})]})]})})}):e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx(b,{className:"w-8 h-8 mr-3 text-primary-600"}),"Inventory Management"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Track and manage your polymer stock levels"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:l,className:"p-2 text-gray-500 hover:text-gray-700 rounded-md hover:bg-gray-100",children:e.jsx(S,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{className:"p-2 rounded-md bg-white shadow-sm",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-2 rounded-md",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsxs("button",{className:"btn-primary flex items-center space-x-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Stock"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(q,{className:"h-8 w-8 text-blue-500"})}),e.jsxs("div",{className:"ml-4 flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Unique Products"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 truncate",children:s.totalUniqueProducts}),e.jsxs("p",{className:"text-xs text-gray-400 truncate",children:[s.totalItems," total batches"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{className:"h-8 w-8 text-green-500"})}),e.jsxs("div",{className:"ml-4 flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Quantity"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 truncate",children:[s.totalQuantity.toLocaleString(),"kg"]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(C,{className:"h-8 w-8 text-yellow-500"})}),e.jsxs("div",{className:"ml-4 flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Value"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 truncate",children:["₹",s.totalValue.toLocaleString()]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(D,{className:"h-8 w-8 text-purple-500"})}),e.jsxs("div",{className:"ml-4 flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Avg. Rate"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 truncate",children:["₹",s.totalQuantity>0?Math.round(s.totalValue/s.totalQuantity):0,"/kg"]})]})]})})]}),t.length===0?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx(b,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No inventory items"}),e.jsx("p",{className:"text-gray-600 mb-4",children:'Your inventory is empty. Stock will be automatically added when you register deals with "New Material" source.'}),e.jsx("button",{className:"btn-primary",children:"Add Manual Stock Entry"})]})}):e.jsx("div",{className:"card",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Inventory Items"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.totalUniqueProducts," unique products • ",s.totalItems," total batches"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:g,disabled:d.isNoneExpanded,className:"btn-secondary text-sm flex items-center space-x-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:"Collapse All"})]}),e.jsxs("button",{onClick:h,disabled:d.isAllExpanded,className:"btn-secondary text-sm flex items-center space-x-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:"Expand All"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Grade"}),e.jsx("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12",children:"Company"}),e.jsx("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Quantity"}),e.jsx("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg Rate"}),e.jsx("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Suppliers"}),e.jsx("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Latest Purchase"})]})}),e.jsx("tbody",{className:"bg-white",children:t.map(m=>e.jsx(F,{groupedItem:m,isExpanded:o(m.productKey),onToggleExpand:()=>y(m.productKey)},m.productKey))})]})}),d.expandedCount>0&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-gray-500",children:[d.expandedCount," of ",d.totalCount," products expanded"]})})]})})]})}export{_ as default};
