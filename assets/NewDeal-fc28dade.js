var Lt=Object.defineProperty;var Mt=(e,s,t)=>s in e?Lt(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var lt=(e,s,t)=>(Mt(e,typeof s!="symbol"?s+"":s,t),t);import{c as _e,r as C,j as r,m as M,A as Nt,R as se,a as Ne,e as He,i as Ot,P as Ie,b as nt,V as je,E as qt}from"./index-8150de43.js";import{c as ie,A as Re,u as Ut,L as ct,S as $t}from"./useDeals-1421468c.js";import{C as Bt}from"./chevron-down-d9920b0a.js";import{P as Ht}from"./plus-e1fa3a4d.js";import{C as Wt}from"./calendar-5685a690.js";import{U as Qt}from"./user-af0a8cfc.js";const jt=_e("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),zt=_e("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Gt=_e("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Yt=_e("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Kt=_e("Truck",[["path",{d:"M10 17h4V5H2v12h3",key:"1jq12e"}],["path",{d:"M20 17h2v-3.34a4 4 0 0 0-1.17-2.83L19 9h-5",key:"1xb3ft"}],["path",{d:"M14 17h1",key:"nufu4t"}],["circle",{cx:"7.5",cy:"17.5",r:"2.5",key:"a7aife"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);function We({options:e,value:s,onChange:t,placeholder:i="Type to search...",className:o,error:n,label:d,required:f}){const[A,S]=C.useState(!1),[N,_]=C.useState(""),[b,O]=C.useState(-1),Q=C.useRef(null),P=C.useRef(null),U=e.filter(y=>{var w,I,T;if(!N.trim())return!0;const D=N.toLowerCase().trim().split(/\s+/).filter(v=>v.length>0),k=[((w=y.label)==null?void 0:w.toLowerCase())||"",((I=y.value)==null?void 0:I.toLowerCase())||"",((T=y.details)==null?void 0:T.toLowerCase())||"",...y.searchableFields?Object.values(y.searchableFields).map(v=>(v==null?void 0:v.toLowerCase())||""):[]].join(" ");return D.every(v=>k.includes(v))});C.useEffect(()=>{if(s){const y=e.find(h=>h.value===s),D=(y==null?void 0:y.label)||s;N!==D&&_(D)}else N!==""&&_("")},[s]);const le=y=>{const D=y.target.value;_(D),S(!0),O(-1);const h=e.find(k=>k.label.toLowerCase()===D.toLowerCase());h&&h.value!==s?t(h.value):!h&&D!==s&&t(D)},F=y=>{var D;t(y.value),_(y.label),S(!1),O(-1),(D=Q.current)==null||D.blur()},z=y=>{var D;if(!A&&(y.key==="ArrowDown"||y.key==="ArrowUp")){S(!0);return}switch(y.key){case"ArrowDown":y.preventDefault(),O(h=>h<U.length-1?h+1:0);break;case"ArrowUp":y.preventDefault(),O(h=>h>0?h-1:U.length-1);break;case"Enter":y.preventDefault(),b>=0&&U[b]&&F(U[b]);break;case"Escape":S(!1),O(-1),(D=Q.current)==null||D.blur();break}},$=(y,D)=>{if(!D.trim())return y;const h=D.toLowerCase().trim().split(/\s+/);let k=y;return h.forEach(w=>{if(w.length>1){const I=new RegExp(`\\b(${w.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})\\b`,"gi");k=k.replace(I,'<strong class="bg-yellow-200">$1</strong>')}}),k};return r.jsxs("div",{className:ie("relative",o),children:[d&&r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[d,f&&r.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{ref:Q,type:"text",value:N,onChange:le,onFocus:()=>S(!0),onBlur:()=>setTimeout(()=>S(!1),200),onKeyDown:z,placeholder:i,className:ie("input-field pr-10",n&&"border-red-500 focus:ring-red-500","transition-all duration-200")}),r.jsx(M.div,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",animate:{rotate:A?180:0},transition:{duration:.2},children:r.jsx(Bt,{className:"w-5 h-5 text-gray-400"})})]}),r.jsx(Nt,{children:A&&U.length>0&&r.jsx(M.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-xl shadow-lg max-h-60 overflow-auto",children:r.jsx("ul",{ref:P,className:"py-2",children:U.map((y,D)=>r.jsxs(M.li,{initial:{opacity:0},animate:{opacity:1},transition:{delay:D*.02},onClick:()=>F(y),className:ie("px-4 py-3 cursor-pointer transition-colors duration-150","hover:bg-gray-50 flex items-center justify-between",b===D&&"bg-primary-50 text-primary-700",s===y.value&&"bg-primary-100 text-primary-800"),children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium",dangerouslySetInnerHTML:{__html:$(y.label,N)}}),y.details&&r.jsx("div",{className:"text-sm text-gray-500 mt-1",dangerouslySetInnerHTML:{__html:$(y.details,N)}}),y.searchableFields&&r.jsx("div",{className:"text-xs text-gray-400 mt-1 space-y-1",children:Object.entries(y.searchableFields).map(([h,k])=>r.jsxs("div",{children:[r.jsxs("span",{className:"font-medium capitalize",children:[h,":"]})," ",r.jsx("span",{dangerouslySetInnerHTML:{__html:$(k,N)}})]},h))})]}),s===y.value&&r.jsx(jt,{className:"w-4 h-4 text-primary-600 ml-2 flex-shrink-0"})]},y.value))})})}),n&&r.jsx(M.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"error-message",children:n})]})}var De=e=>e.type==="checkbox",be=e=>e instanceof Date,Z=e=>e==null;const wt=e=>typeof e=="object";var B=e=>!Z(e)&&!Array.isArray(e)&&wt(e)&&!be(e),Jt=e=>B(e)&&e.target?De(e.target)?e.target.checked:e.target.value:e,Xt=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,Zt=(e,s)=>e.has(Xt(s)),es=e=>{const s=e.constructor&&e.constructor.prototype;return B(s)&&s.hasOwnProperty("isPrototypeOf")},Ye=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Y(e){let s;const t=Array.isArray(e),i=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)s=new Date(e);else if(!(Ye&&(e instanceof Blob||i))&&(t||B(e)))if(s=t?[]:{},!t&&!es(e))s=e;else for(const o in e)e.hasOwnProperty(o)&&(s[o]=Y(e[o]));else return e;return s}var Oe=e=>/^\w*$/.test(e),W=e=>e===void 0,Ke=e=>Array.isArray(e)?e.filter(Boolean):[],Je=e=>Ke(e.replace(/["|']|\]/g,"").split(/\.|\[/)),g=(e,s,t)=>{if(!s||!B(e))return t;const i=(Oe(s)?[s]:Je(s)).reduce((o,n)=>Z(o)?o:o[n],e);return W(i)||i===e?W(e[s])?t:e[s]:i},oe=e=>typeof e=="boolean",L=(e,s,t)=>{let i=-1;const o=Oe(s)?[s]:Je(s),n=o.length,d=n-1;for(;++i<n;){const f=o[i];let A=t;if(i!==d){const S=e[f];A=B(S)||Array.isArray(S)?S:isNaN(+o[i+1])?{}:[]}if(f==="__proto__"||f==="constructor"||f==="prototype")return;e[f]=A,e=e[f]}};const ot={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},ne={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},fe={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},ts=se.createContext(null);ts.displayName="HookFormContext";var ss=(e,s,t,i=!0)=>{const o={defaultValues:s._defaultValues};for(const n in e)Object.defineProperty(o,n,{get:()=>{const d=n;return s._proxyFormState[d]!==ne.all&&(s._proxyFormState[d]=!i||ne.all),t&&(t[d]=!0),e[d]}});return o};const rs=typeof window<"u"?se.useLayoutEffect:se.useEffect;var de=e=>typeof e=="string",as=(e,s,t,i,o)=>de(e)?(i&&s.watch.add(e),g(t,e,o)):Array.isArray(e)?e.map(n=>(i&&s.watch.add(n),g(t,n))):(i&&(s.watchAll=!0),t),Ge=e=>Z(e)||!wt(e);function ge(e,s,t=new WeakSet){if(Ge(e)||Ge(s))return e===s;if(be(e)&&be(s))return e.getTime()===s.getTime();const i=Object.keys(e),o=Object.keys(s);if(i.length!==o.length)return!1;if(t.has(e)||t.has(s))return!0;t.add(e),t.add(s);for(const n of i){const d=e[n];if(!o.includes(n))return!1;if(n!=="ref"){const f=s[n];if(be(d)&&be(f)||B(d)&&B(f)||Array.isArray(d)&&Array.isArray(f)?!ge(d,f,t):d!==f)return!1}}return!0}var is=(e,s,t,i,o)=>s?{...t[e],types:{...t[e]&&t[e].types?t[e].types:{},[i]:o||!0}}:{},Ae=e=>Array.isArray(e)?e:[e],dt=()=>{let e=[];return{get observers(){return e},next:o=>{for(const n of e)n.next&&n.next(o)},subscribe:o=>(e.push(o),{unsubscribe:()=>{e=e.filter(n=>n!==o)}}),unsubscribe:()=>{e=[]}}},ee=e=>B(e)&&!Object.keys(e).length,Xe=e=>e.type==="file",ce=e=>typeof e=="function",Te=e=>{if(!Ye)return!1;const s=e?e.ownerDocument:0;return e instanceof(s&&s.defaultView?s.defaultView.HTMLElement:HTMLElement)},St=e=>e.type==="select-multiple",Ze=e=>e.type==="radio",ls=e=>Ze(e)||De(e),Qe=e=>Te(e)&&e.isConnected;function ns(e,s){const t=s.slice(0,-1).length;let i=0;for(;i<t;)e=W(e)?i++:e[s[i++]];return e}function cs(e){for(const s in e)if(e.hasOwnProperty(s)&&!W(e[s]))return!1;return!0}function H(e,s){const t=Array.isArray(s)?s:Oe(s)?[s]:Je(s),i=t.length===1?e:ns(e,t),o=t.length-1,n=t[o];return i&&delete i[n],o!==0&&(B(i)&&ee(i)||Array.isArray(i)&&cs(i))&&H(e,t.slice(0,-1)),e}var kt=e=>{for(const s in e)if(ce(e[s]))return!0;return!1};function Le(e,s={}){const t=Array.isArray(e);if(B(e)||t)for(const i in e)Array.isArray(e[i])||B(e[i])&&!kt(e[i])?(s[i]=Array.isArray(e[i])?[]:{},Le(e[i],s[i])):Z(e[i])||(s[i]=!0);return s}function Ft(e,s,t){const i=Array.isArray(e);if(B(e)||i)for(const o in e)Array.isArray(e[o])||B(e[o])&&!kt(e[o])?W(s)||Ge(t[o])?t[o]=Array.isArray(e[o])?Le(e[o],[]):{...Le(e[o])}:Ft(e[o],Z(s)?{}:s[o],t[o]):t[o]=!ge(e[o],s[o]);return t}var ke=(e,s)=>Ft(e,s,Le(s));const ut={value:!1,isValid:!1},ft={value:!0,isValid:!0};var At=e=>{if(Array.isArray(e)){if(e.length>1){const s=e.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:s,isValid:!!s.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!W(e[0].attributes.value)?W(e[0].value)||e[0].value===""?ft:{value:e[0].value,isValid:!0}:ft:ut}return ut},Vt=(e,{valueAsNumber:s,valueAsDate:t,setValueAs:i})=>W(e)?e:s?e===""?NaN:e&&+e:t&&de(e)?new Date(e):i?i(e):e;const mt={isValid:!1,value:null};var _t=e=>Array.isArray(e)?e.reduce((s,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:s,mt):mt;function ht(e){const s=e.ref;return Xe(s)?s.files:Ze(s)?_t(e.refs).value:St(s)?[...s.selectedOptions].map(({value:t})=>t):De(s)?At(e.refs).value:Vt(W(s.value)?e.ref.value:s.value,e)}var os=(e,s,t,i)=>{const o={};for(const n of e){const d=g(s,n);d&&L(o,n,d._f)}return{criteriaMode:t,names:[...e],fields:o,shouldUseNativeValidation:i}},Me=e=>e instanceof RegExp,Fe=e=>W(e)?e:Me(e)?e.source:B(e)?Me(e.value)?e.value.source:e.value:e,yt=e=>({isOnSubmit:!e||e===ne.onSubmit,isOnBlur:e===ne.onBlur,isOnChange:e===ne.onChange,isOnAll:e===ne.all,isOnTouch:e===ne.onTouched});const xt="AsyncFunction";var ds=e=>!!e&&!!e.validate&&!!(ce(e.validate)&&e.validate.constructor.name===xt||B(e.validate)&&Object.values(e.validate).find(s=>s.constructor.name===xt)),us=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),gt=(e,s,t)=>!t&&(s.watchAll||s.watch.has(e)||[...s.watch].some(i=>e.startsWith(i)&&/^\.\w+/.test(e.slice(i.length))));const Ve=(e,s,t,i)=>{for(const o of t||Object.keys(e)){const n=g(e,o);if(n){const{_f:d,...f}=n;if(d){if(d.refs&&d.refs[0]&&s(d.refs[0],o)&&!i)return!0;if(d.ref&&s(d.ref,d.name)&&!i)return!0;if(Ve(f,s))break}else if(B(f)&&Ve(f,s))break}}};function pt(e,s,t){const i=g(e,t);if(i||Oe(t))return{error:i,name:t};const o=t.split(".");for(;o.length;){const n=o.join("."),d=g(s,n),f=g(e,n);if(d&&!Array.isArray(d)&&t!==n)return{name:t};if(f&&f.type)return{name:n,error:f};if(f&&f.root&&f.root.type)return{name:`${n}.root`,error:f.root};o.pop()}return{name:t}}var fs=(e,s,t,i)=>{t(e);const{name:o,...n}=e;return ee(n)||Object.keys(n).length>=Object.keys(s).length||Object.keys(n).find(d=>s[d]===(!i||ne.all))},ms=(e,s,t)=>!e||!s||e===s||Ae(e).some(i=>i&&(t?i===s:i.startsWith(s)||s.startsWith(i))),hs=(e,s,t,i,o)=>o.isOnAll?!1:!t&&o.isOnTouch?!(s||e):(t?i.isOnBlur:o.isOnBlur)?!e:(t?i.isOnChange:o.isOnChange)?e:!0,ys=(e,s)=>!Ke(g(e,s)).length&&H(e,s),xs=(e,s,t)=>{const i=Ae(g(e,t));return L(i,"root",s[t]),L(e,t,i),e},Ee=e=>de(e);function vt(e,s,t="validate"){if(Ee(e)||Array.isArray(e)&&e.every(Ee)||oe(e)&&!e)return{type:t,message:Ee(e)?e:"",ref:s}}var we=e=>B(e)&&!Me(e)?e:{value:e,message:""},bt=async(e,s,t,i,o,n)=>{const{ref:d,refs:f,required:A,maxLength:S,minLength:N,min:_,max:b,pattern:O,validate:Q,name:P,valueAsNumber:U,mount:le}=e._f,F=g(t,P);if(!le||s.has(P))return{};const z=f?f[0]:d,$=v=>{o&&z.reportValidity&&(z.setCustomValidity(oe(v)?"":v||""),z.reportValidity())},y={},D=Ze(d),h=De(d),k=D||h,w=(U||Xe(d))&&W(d.value)&&W(F)||Te(d)&&d.value===""||F===""||Array.isArray(F)&&!F.length,I=is.bind(null,P,i,y),T=(v,V,q,K=fe.maxLength,J=fe.minLength)=>{const re=v?V:q;y[P]={type:v?K:J,message:re,ref:d,...I(v?K:J,re)}};if(n?!Array.isArray(F)||!F.length:A&&(!k&&(w||Z(F))||oe(F)&&!F||h&&!At(f).isValid||D&&!_t(f).isValid)){const{value:v,message:V}=Ee(A)?{value:!!A,message:A}:we(A);if(v&&(y[P]={type:fe.required,message:V,ref:z,...I(fe.required,V)},!i))return $(V),y}if(!w&&(!Z(_)||!Z(b))){let v,V;const q=we(b),K=we(_);if(!Z(F)&&!isNaN(F)){const J=d.valueAsNumber||F&&+F;Z(q.value)||(v=J>q.value),Z(K.value)||(V=J<K.value)}else{const J=d.valueAsDate||new Date(F),re=ve=>new Date(new Date().toDateString()+" "+ve),pe=d.type=="time",me=d.type=="week";de(q.value)&&F&&(v=pe?re(F)>re(q.value):me?F>q.value:J>new Date(q.value)),de(K.value)&&F&&(V=pe?re(F)<re(K.value):me?F<K.value:J<new Date(K.value))}if((v||V)&&(T(!!v,q.message,K.message,fe.max,fe.min),!i))return $(y[P].message),y}if((S||N)&&!w&&(de(F)||n&&Array.isArray(F))){const v=we(S),V=we(N),q=!Z(v.value)&&F.length>+v.value,K=!Z(V.value)&&F.length<+V.value;if((q||K)&&(T(q,v.message,V.message),!i))return $(y[P].message),y}if(O&&!w&&de(F)){const{value:v,message:V}=we(O);if(Me(v)&&!F.match(v)&&(y[P]={type:fe.pattern,message:V,ref:d,...I(fe.pattern,V)},!i))return $(V),y}if(Q){if(ce(Q)){const v=await Q(F,t),V=vt(v,z);if(V&&(y[P]={...V,...I(fe.validate,V.message)},!i))return $(V.message),y}else if(B(Q)){let v={};for(const V in Q){if(!ee(v)&&!i)break;const q=vt(await Q[V](F,t),z,V);q&&(v={...q,...I(V,q.message)},$(q.message),i&&(y[P]=v))}if(!ee(v)&&(y[P]={ref:z,...v},!i))return y}}return $(!0),y};const gs={mode:ne.onSubmit,reValidateMode:ne.onChange,shouldFocusError:!0};function ps(e={}){let s={...gs,...e},t={submitCount:0,isDirty:!1,isReady:!1,isLoading:ce(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},i={},o=B(s.defaultValues)||B(s.values)?Y(s.defaultValues||s.values)||{}:{},n=s.shouldUnregister?{}:Y(o),d={action:!1,mount:!1,watch:!1},f={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},A,S=0;const N={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let _={...N};const b={array:dt(),state:dt()},O=s.criteriaMode===ne.all,Q=a=>l=>{clearTimeout(S),S=setTimeout(a,l)},P=async a=>{if(!s.disabled&&(N.isValid||_.isValid||a)){const l=s.resolver?ee((await h()).errors):await w(i,!0);l!==t.isValid&&b.state.next({isValid:l})}},U=(a,l)=>{!s.disabled&&(N.isValidating||N.validatingFields||_.isValidating||_.validatingFields)&&((a||Array.from(f.mount)).forEach(c=>{c&&(l?L(t.validatingFields,c,l):H(t.validatingFields,c))}),b.state.next({validatingFields:t.validatingFields,isValidating:!ee(t.validatingFields)}))},le=(a,l=[],c,x,m=!0,u=!0)=>{if(x&&c&&!s.disabled){if(d.action=!0,u&&Array.isArray(g(i,a))){const p=c(g(i,a),x.argA,x.argB);m&&L(i,a,p)}if(u&&Array.isArray(g(t.errors,a))){const p=c(g(t.errors,a),x.argA,x.argB);m&&L(t.errors,a,p),ys(t.errors,a)}if((N.touchedFields||_.touchedFields)&&u&&Array.isArray(g(t.touchedFields,a))){const p=c(g(t.touchedFields,a),x.argA,x.argB);m&&L(t.touchedFields,a,p)}(N.dirtyFields||_.dirtyFields)&&(t.dirtyFields=ke(o,n)),b.state.next({name:a,isDirty:T(a,l),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else L(n,a,l)},F=(a,l)=>{L(t.errors,a,l),b.state.next({errors:t.errors})},z=a=>{t.errors=a,b.state.next({errors:t.errors,isValid:!1})},$=(a,l,c,x)=>{const m=g(i,a);if(m){const u=g(n,a,W(c)?g(o,a):c);W(u)||x&&x.defaultChecked||l?L(n,a,l?u:ht(m._f)):q(a,u),d.mount&&P()}},y=(a,l,c,x,m)=>{let u=!1,p=!1;const E={name:a};if(!s.disabled){if(!c||x){(N.isDirty||_.isDirty)&&(p=t.isDirty,t.isDirty=E.isDirty=T(),u=p!==E.isDirty);const R=ge(g(o,a),l);p=!!g(t.dirtyFields,a),R?H(t.dirtyFields,a):L(t.dirtyFields,a,!0),E.dirtyFields=t.dirtyFields,u=u||(N.dirtyFields||_.dirtyFields)&&p!==!R}if(c){const R=g(t.touchedFields,a);R||(L(t.touchedFields,a,c),E.touchedFields=t.touchedFields,u=u||(N.touchedFields||_.touchedFields)&&R!==c)}u&&m&&b.state.next(E)}return u?E:{}},D=(a,l,c,x)=>{const m=g(t.errors,a),u=(N.isValid||_.isValid)&&oe(l)&&t.isValid!==l;if(s.delayError&&c?(A=Q(()=>F(a,c)),A(s.delayError)):(clearTimeout(S),A=null,c?L(t.errors,a,c):H(t.errors,a)),(c?!ge(m,c):m)||!ee(x)||u){const p={...x,...u&&oe(l)?{isValid:l}:{},errors:t.errors,name:a};t={...t,...p},b.state.next(p)}},h=async a=>{U(a,!0);const l=await s.resolver(n,s.context,os(a||f.mount,i,s.criteriaMode,s.shouldUseNativeValidation));return U(a),l},k=async a=>{const{errors:l}=await h(a);if(a)for(const c of a){const x=g(l,c);x?L(t.errors,c,x):H(t.errors,c)}else t.errors=l;return l},w=async(a,l,c={valid:!0})=>{for(const x in a){const m=a[x];if(m){const{_f:u,...p}=m;if(u){const E=f.array.has(u.name),R=m._f&&ds(m._f);R&&N.validatingFields&&U([x],!0);const ae=await bt(m,f.disabled,n,O,s.shouldUseNativeValidation&&!l,E);if(R&&N.validatingFields&&U([x]),ae[u.name]&&(c.valid=!1,l))break;!l&&(g(ae,u.name)?E?xs(t.errors,ae,u.name):L(t.errors,u.name,ae[u.name]):H(t.errors,u.name))}!ee(p)&&await w(p,l,c)}}return c.valid},I=()=>{for(const a of f.unMount){const l=g(i,a);l&&(l._f.refs?l._f.refs.every(c=>!Qe(c)):!Qe(l._f.ref))&&ue(a)}f.unMount=new Set},T=(a,l)=>!s.disabled&&(a&&l&&L(n,a,l),!ge(ve(),o)),v=(a,l,c)=>as(a,f,{...d.mount?n:W(l)?o:de(a)?{[a]:l}:l},c,l),V=a=>Ke(g(d.mount?n:o,a,s.shouldUnregister?g(o,a,[]):[])),q=(a,l,c={})=>{const x=g(i,a);let m=l;if(x){const u=x._f;u&&(!u.disabled&&L(n,a,Vt(l,u)),m=Te(u.ref)&&Z(l)?"":l,St(u.ref)?[...u.ref.options].forEach(p=>p.selected=m.includes(p.value)):u.refs?De(u.ref)?u.refs.forEach(p=>{(!p.defaultChecked||!p.disabled)&&(Array.isArray(m)?p.checked=!!m.find(E=>E===p.value):p.checked=m===p.value||!!m)}):u.refs.forEach(p=>p.checked=p.value===m):Xe(u.ref)?u.ref.value="":(u.ref.value=m,u.ref.type||b.state.next({name:a,values:Y(n)})))}(c.shouldDirty||c.shouldTouch)&&y(a,m,c.shouldTouch,c.shouldDirty,!0),c.shouldValidate&&me(a)},K=(a,l,c)=>{for(const x in l){if(!l.hasOwnProperty(x))return;const m=l[x],u=a+"."+x,p=g(i,u);(f.array.has(a)||B(m)||p&&!p._f)&&!be(m)?K(u,m,c):q(u,m,c)}},J=(a,l,c={})=>{const x=g(i,a),m=f.array.has(a),u=Y(l);L(n,a,u),m?(b.array.next({name:a,values:Y(n)}),(N.isDirty||N.dirtyFields||_.isDirty||_.dirtyFields)&&c.shouldDirty&&b.state.next({name:a,dirtyFields:ke(o,n),isDirty:T(a,u)})):x&&!x._f&&!Z(u)?K(a,u,c):q(a,u,c),gt(a,f)&&b.state.next({...t,name:a}),b.state.next({name:d.mount?a:void 0,values:Y(n)})},re=async a=>{d.mount=!0;const l=a.target;let c=l.name,x=!0;const m=g(i,c),u=R=>{x=Number.isNaN(R)||be(R)&&isNaN(R.getTime())||ge(R,g(n,c,R))},p=yt(s.mode),E=yt(s.reValidateMode);if(m){let R,ae;const Ce=l.type?ht(m._f):Jt(a),ye=a.type===ot.BLUR||a.type===ot.FOCUS_OUT,It=!us(m._f)&&!s.resolver&&!g(t.errors,c)&&!m._f.deps||hs(ye,g(t.touchedFields,c),t.isSubmitted,E,p),$e=gt(c,f,ye);L(n,c,Ce),ye?(m._f.onBlur&&m._f.onBlur(a),A&&A(0)):m._f.onChange&&m._f.onChange(a);const Be=y(c,Ce,ye),Rt=!ee(Be)||$e;if(!ye&&b.state.next({name:c,type:a.type,values:Y(n)}),It)return(N.isValid||_.isValid)&&(s.mode==="onBlur"?ye&&P():ye||P()),Rt&&b.state.next({name:c,...$e?{}:Be});if(!ye&&$e&&b.state.next({...t}),s.resolver){const{errors:at}=await h([c]);if(u(Ce),x){const Tt=pt(t.errors,i,c),it=pt(at,i,Tt.name||c);R=it.error,c=it.name,ae=ee(at)}}else U([c],!0),R=(await bt(m,f.disabled,n,O,s.shouldUseNativeValidation))[c],U([c]),u(Ce),x&&(R?ae=!1:(N.isValid||_.isValid)&&(ae=await w(i,!0)));x&&(m._f.deps&&me(m._f.deps),D(c,ae,R,Be))}},pe=(a,l)=>{if(g(t.errors,l)&&a.focus)return a.focus(),1},me=async(a,l={})=>{let c,x;const m=Ae(a);if(s.resolver){const u=await k(W(a)?a:m);c=ee(u),x=a?!m.some(p=>g(u,p)):c}else a?(x=(await Promise.all(m.map(async u=>{const p=g(i,u);return await w(p&&p._f?{[u]:p}:p)}))).every(Boolean),!(!x&&!t.isValid)&&P()):x=c=await w(i);return b.state.next({...!de(a)||(N.isValid||_.isValid)&&c!==t.isValid?{}:{name:a},...s.resolver||!a?{isValid:c}:{},errors:t.errors}),l.shouldFocus&&!x&&Ve(i,pe,a?m:f.mount),x},ve=a=>{const l={...d.mount?n:o};return W(a)?l:de(a)?g(l,a):a.map(c=>g(l,c))},Se=(a,l)=>({invalid:!!g((l||t).errors,a),isDirty:!!g((l||t).dirtyFields,a),error:g((l||t).errors,a),isValidating:!!g(t.validatingFields,a),isTouched:!!g((l||t).touchedFields,a)}),Pe=a=>{a&&Ae(a).forEach(l=>H(t.errors,l)),b.state.next({errors:a?t.errors:{}})},j=(a,l,c)=>{const x=(g(i,a,{_f:{}})._f||{}).ref,m=g(t.errors,a)||{},{ref:u,message:p,type:E,...R}=m;L(t.errors,a,{...R,...l,ref:x}),b.state.next({name:a,errors:t.errors,isValid:!1}),c&&c.shouldFocus&&x&&x.focus&&x.focus()},G=(a,l)=>ce(a)?b.state.subscribe({next:c=>"values"in c&&a(v(void 0,l),c)}):v(a,l,!0),X=a=>b.state.subscribe({next:l=>{ms(a.name,l.name,a.exact)&&fs(l,a.formState||N,Et,a.reRenderRoot)&&a.callback({values:{...n},...t,...l,defaultValues:o})}}).unsubscribe,te=a=>(d.mount=!0,_={..._,...a.formState},X({...a,formState:_})),ue=(a,l={})=>{for(const c of a?Ae(a):f.mount)f.mount.delete(c),f.array.delete(c),l.keepValue||(H(i,c),H(n,c)),!l.keepError&&H(t.errors,c),!l.keepDirty&&H(t.dirtyFields,c),!l.keepTouched&&H(t.touchedFields,c),!l.keepIsValidating&&H(t.validatingFields,c),!s.shouldUnregister&&!l.keepDefaultValue&&H(o,c);b.state.next({values:Y(n)}),b.state.next({...t,...l.keepDirty?{isDirty:T()}:{}}),!l.keepIsValid&&P()},he=({disabled:a,name:l})=>{(oe(a)&&d.mount||a||f.disabled.has(l))&&(a?f.disabled.add(l):f.disabled.delete(l))},qe=(a,l={})=>{let c=g(i,a);const x=oe(l.disabled)||oe(s.disabled);return L(i,a,{...c||{},_f:{...c&&c._f?c._f:{ref:{name:a}},name:a,mount:!0,...l}}),f.mount.add(a),c?he({disabled:oe(l.disabled)?l.disabled:s.disabled,name:a}):$(a,!0,l.value),{...x?{disabled:l.disabled||s.disabled}:{},...s.progressive?{required:!!l.required,min:Fe(l.min),max:Fe(l.max),minLength:Fe(l.minLength),maxLength:Fe(l.maxLength),pattern:Fe(l.pattern)}:{},name:a,onChange:re,onBlur:re,ref:m=>{if(m){qe(a,l),c=g(i,a);const u=W(m.value)&&m.querySelectorAll&&m.querySelectorAll("input,select,textarea")[0]||m,p=ls(u),E=c._f.refs||[];if(p?E.find(R=>R===u):u===c._f.ref)return;L(i,a,{_f:{...c._f,...p?{refs:[...E.filter(Qe),u,...Array.isArray(g(o,a))?[{}]:[]],ref:{type:u.type,name:a}}:{ref:u}}}),$(a,!1,void 0,u)}else c=g(i,a,{}),c._f&&(c._f.mount=!1),(s.shouldUnregister||l.shouldUnregister)&&!(Zt(f.array,a)&&d.action)&&f.unMount.add(a)}}},Ue=()=>s.shouldFocusError&&Ve(i,pe,f.mount),Dt=a=>{oe(a)&&(b.state.next({disabled:a}),Ve(i,(l,c)=>{const x=g(i,c);x&&(l.disabled=x._f.disabled||a,Array.isArray(x._f.refs)&&x._f.refs.forEach(m=>{m.disabled=x._f.disabled||a}))},0,!1))},et=(a,l)=>async c=>{let x;c&&(c.preventDefault&&c.preventDefault(),c.persist&&c.persist());let m=Y(n);if(b.state.next({isSubmitting:!0}),s.resolver){const{errors:u,values:p}=await h();t.errors=u,m=Y(p)}else await w(i);if(f.disabled.size)for(const u of f.disabled)H(m,u);if(H(t.errors,"root"),ee(t.errors)){b.state.next({errors:{}});try{await a(m,c)}catch(u){x=u}}else l&&await l({...t.errors},c),Ue(),setTimeout(Ue);if(b.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ee(t.errors)&&!x,submitCount:t.submitCount+1,errors:t.errors}),x)throw x},Pt=(a,l={})=>{g(i,a)&&(W(l.defaultValue)?J(a,Y(g(o,a))):(J(a,l.defaultValue),L(o,a,Y(l.defaultValue))),l.keepTouched||H(t.touchedFields,a),l.keepDirty||(H(t.dirtyFields,a),t.isDirty=l.defaultValue?T(a,Y(g(o,a))):T()),l.keepError||(H(t.errors,a),N.isValid&&P()),b.state.next({...t}))},tt=(a,l={})=>{const c=a?Y(a):o,x=Y(c),m=ee(a),u=m?o:x;if(l.keepDefaultValues||(o=c),!l.keepValues){if(l.keepDirtyValues){const p=new Set([...f.mount,...Object.keys(ke(o,n))]);for(const E of Array.from(p))g(t.dirtyFields,E)?L(u,E,g(n,E)):J(E,g(u,E))}else{if(Ye&&W(a))for(const p of f.mount){const E=g(i,p);if(E&&E._f){const R=Array.isArray(E._f.refs)?E._f.refs[0]:E._f.ref;if(Te(R)){const ae=R.closest("form");if(ae){ae.reset();break}}}}if(l.keepFieldsRef)for(const p of f.mount)J(p,g(u,p));else i={}}n=s.shouldUnregister?l.keepDefaultValues?Y(o):{}:Y(u),b.array.next({values:{...u}}),b.state.next({values:{...u}})}f={mount:l.keepDirtyValues?f.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},d.mount=!N.isValid||!!l.keepIsValid||!!l.keepDirtyValues,d.watch=!!s.shouldUnregister,b.state.next({submitCount:l.keepSubmitCount?t.submitCount:0,isDirty:m?!1:l.keepDirty?t.isDirty:!!(l.keepDefaultValues&&!ge(a,o)),isSubmitted:l.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:m?{}:l.keepDirtyValues?l.keepDefaultValues&&n?ke(o,n):t.dirtyFields:l.keepDefaultValues&&a?ke(o,a):l.keepDirty?t.dirtyFields:{},touchedFields:l.keepTouched?t.touchedFields:{},errors:l.keepErrors?t.errors:{},isSubmitSuccessful:l.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1})},st=(a,l)=>tt(ce(a)?a(n):a,l),Ct=(a,l={})=>{const c=g(i,a),x=c&&c._f;if(x){const m=x.refs?x.refs[0]:x.ref;m.focus&&(m.focus(),l.shouldSelect&&ce(m.select)&&m.select())}},Et=a=>{t={...t,...a}},rt={control:{register:qe,unregister:ue,getFieldState:Se,handleSubmit:et,setError:j,_subscribe:X,_runSchema:h,_focusError:Ue,_getWatch:v,_getDirty:T,_setValid:P,_setFieldArray:le,_setDisabledField:he,_setErrors:z,_getFieldArray:V,_reset:tt,_resetDefaultValues:()=>ce(s.defaultValues)&&s.defaultValues().then(a=>{st(a,s.resetOptions),b.state.next({isLoading:!1})}),_removeUnmounted:I,_disableForm:Dt,_subjects:b,_proxyFormState:N,get _fields(){return i},get _formValues(){return n},get _state(){return d},set _state(a){d=a},get _defaultValues(){return o},get _names(){return f},set _names(a){f=a},get _formState(){return t},get _options(){return s},set _options(a){s={...s,...a}}},subscribe:te,trigger:me,register:qe,handleSubmit:et,watch:G,setValue:J,getValues:ve,reset:st,resetField:Pt,clearErrors:Pe,unregister:ue,setError:j,setFocus:Ct,getFieldState:Se};return{...rt,formControl:rt}}function vs(e={}){const s=se.useRef(void 0),t=se.useRef(void 0),[i,o]=se.useState({isDirty:!1,isValidating:!1,isLoading:ce(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:ce(e.defaultValues)?void 0:e.defaultValues});if(!s.current)if(e.formControl)s.current={...e.formControl,formState:i},e.defaultValues&&!ce(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:d,...f}=ps(e);s.current={...f,formState:i}}const n=s.current.control;return n._options=e,rs(()=>{const d=n._subscribe({formState:n._proxyFormState,callback:()=>o({...n._formState}),reRenderRoot:!0});return o(f=>({...f,isReady:!0})),n._formState.isReady=!0,d},[n]),se.useEffect(()=>n._disableForm(e.disabled),[n,e.disabled]),se.useEffect(()=>{e.mode&&(n._options.mode=e.mode),e.reValidateMode&&(n._options.reValidateMode=e.reValidateMode)},[n,e.mode,e.reValidateMode]),se.useEffect(()=>{e.errors&&(n._setErrors(e.errors),n._focusError())},[n,e.errors]),se.useEffect(()=>{e.shouldUnregister&&n._subjects.state.next({values:n._getWatch()})},[n,e.shouldUnregister]),se.useEffect(()=>{if(n._proxyFormState.isDirty){const d=n._getDirty();d!==i.isDirty&&n._subjects.state.next({isDirty:d})}},[n,i.isDirty]),se.useEffect(()=>{e.values&&!ge(e.values,t.current)?(n._reset(e.values,{keepFieldsRef:!0,...n._options.resetOptions}),t.current=e.values,o(d=>({...d}))):n._resetDefaultValues()},[n,e.values]),se.useEffect(()=>{n._state.mount||(n._setValid(),n._state.mount=!0),n._state.watch&&(n._state.watch=!1,n._subjects.state.next({...n._formState})),n._removeUnmounted()}),s.current.formState=ss(i,n),s.current}const bs=e=>e.map(s=>({value:s.productCode,label:s.productCode,details:`${s.grade} | ${s.company} | ${s.specificGrade}`,searchableFields:{grade:s.grade,company:s.company,specificGrade:s.specificGrade}}));class Ns{constructor(){lt(this,"endpoint","/products")}async getProducts(){try{console.log("ðŸ“¦ ProductService: Fetching products");const s=await Ne.get(this.endpoint);return console.log("âœ… ProductService: Products fetched successfully"),s}catch(s){throw console.error("âŒ ProductService: Failed to fetch products",s),s}}async createProduct(s){try{console.log("ðŸ“¦ ProductService: Creating product",s.productCode);const t=await Ne.post(this.endpoint,s);return t.success&&t.data&&(He.emit("product.added",t.data,"ProductService"),console.log("âœ… ProductService: Product created successfully")),t}catch(t){throw console.error("âŒ ProductService: Failed to create product",t),t}}async getProduct(s){try{console.log("ðŸ“¦ ProductService: Fetching product",s);const t=await Ne.get(`${this.endpoint}/${s}`);return console.log("âœ… ProductService: Product fetched successfully"),t}catch(t){throw console.error("âŒ ProductService: Failed to fetch product",t),t}}async updateProduct(s,t){try{console.log("ðŸ“¦ ProductService: Updating product",s);const i=await Ne.put(`${this.endpoint}/update`,{id:s,...t});return i.success&&i.data&&(He.emit("product.updated",i.data,"ProductService"),console.log("âœ… ProductService: Product updated successfully")),i}catch(i){throw console.error("âŒ ProductService: Failed to update product",i),i}}async deleteProduct(s){try{console.log("ðŸ“¦ ProductService: Deleting product",s);const t=await Ne.delete(`${this.endpoint}/remove/${s}`);return t.success&&(He.emit("product.deleted",{id:s},"ProductService"),console.log("âœ… ProductService: Product deleted successfully")),t}catch(t){throw console.error("âŒ ProductService: Failed to delete product",t),t}}async searchProducts(s){try{console.log("ðŸ“¦ ProductService: Searching products",s);const t=await Ne.get(`${this.endpoint}/search`,{q:s});return console.log("âœ… ProductService: Product search completed"),t}catch(t){throw console.error("âŒ ProductService: Failed to search products",t),t}}}const js=new Ns;function ws({productCode:e,grade:s,company:t,specificGrade:i,requiredQuantity:o,onSelectionChange:n,onProductAutoFill:d}){const[f,A]=C.useState([]),[S,N]=C.useState([]),[_,b]=C.useState(!1),[O,Q]=C.useState(null),[P,U]=C.useState(1);C.useEffect(()=>{e&&s&&t&&i?le():(A([]),N([]))},[e,s,t,i]),C.useEffect(()=>{const h=S.map(k=>({id:k.id,quantity:k.selectedQuantity}));n(h)},[S,n]);const le=async()=>{try{b(!0),Q(null);const h=await Ot.getAvailableInventoryItems(e,s,t,i);h.success&&h.data?(A(h.data),h.data.length>0&&d&&d(h.data[0])):Q("Failed to load inventory items")}catch(h){Q(h instanceof Error?h.message:"Unknown error")}finally{b(!1)}},F=h=>{const k=S.findIndex(V=>V.id===h.id);if(k>=0){const V=[...S];V.splice(k,1),N(V);return}const w=$(),I=o-w;if(I<=0)return;const T=Math.min(I,h.quantity),v={id:h.id,selectedQuantity:T,availableQuantity:h.quantity,selectionOrder:P,item:h};N([...S,v]),U(P+1)},z=(h,k)=>{const w=S.findIndex(I=>I.id===h.id);if(w>=0){const I=[...S];if(k<=0)I.splice(w,1);else{const T=Math.min(h.quantity,k+(o-$()));I[w]={...I[w],selectedQuantity:Math.min(k,T)}}N(I)}},$=()=>S.reduce((h,k)=>h+k.selectedQuantity,0),y=()=>{const h=$();return h===0?{color:"text-gray-500",text:"No items selected"}:h<o?{color:"text-yellow-600",text:`Need ${o-h}kg more`}:h===o?{color:"text-green-600",text:"Perfect match!"}:{color:"text-red-600",text:`${h-o}kg excess selected`}};if(_)return r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Ie,{className:"w-5 h-5 text-blue-500 animate-pulse"}),r.jsx("span",{className:"ml-2 text-blue-700",children:"Loading available inventory..."})]})});if(O)return r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Re,{className:"w-5 h-5 text-red-500"}),r.jsx("span",{className:"ml-2 text-red-700",children:O})]})});if(f.length===0)return r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Ie,{className:"w-5 h-5 text-yellow-500"}),r.jsxs("span",{className:"ml-2 text-yellow-700",children:["No inventory available for ",e," - ",s," - ",t," - ",i]})]})});const D=y();return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Selection Status:"}),r.jsx("span",{className:`ml-2 text-sm font-medium ${D.color}`,children:D.text})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:["Required: ",o,"kg"]}),r.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Selected: ",$(),"kg"]}),S.length>0&&r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["From ",S.length," item",S.length>1?"s":""]})]})]}),S.length>0&&r.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[r.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Selection Order:"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:S.sort((h,k)=>h.selectionOrder-k.selectionOrder).map((h,k)=>r.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs",children:[r.jsxs("span",{className:"font-medium",children:[k+1,"."]}),r.jsxs("span",{children:[h.selectedQuantity,"kg from ",h.item.purchaseParty]}),r.jsxs("span",{className:"text-blue-600",children:["(â‚¹",h.item.rate,"/kg)"]})]},h.id))})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("h4",{className:"text-sm font-medium text-gray-900",children:["Available Inventory (",f.length," items)"]}),f.map(h=>{const k=S.find(v=>v.id===h.id),w=(k==null?void 0:k.selectedQuantity)||0,I=o-$(),T=I>0||w>0;return r.jsx(Ss,{item:h,selectedQuantity:w,selectionOrder:k==null?void 0:k.selectionOrder,canSelect:T,remainingNeeded:I,onItemClick:()=>F(h),onQuantityChange:v=>z(h,v)},h.id)})]})]})}function Ss({item:e,selectedQuantity:s,selectionOrder:t,canSelect:i,remainingNeeded:o,onItemClick:n,onQuantityChange:d}){const[f,A]=C.useState(s.toString());C.useEffect(()=>{A(s.toString())},[s]);const S=()=>{const O=Math.max(0,parseFloat(f)||0);d(O)},N=s>0,_=e.quantity<1e3?"low":"good",b=N?s:Math.min(o,e.quantity);return r.jsxs("div",{className:`border rounded-lg p-4 transition-all ${N?"border-blue-500 bg-blue-50":i?"border-gray-200 hover:border-gray-300":"border-gray-200 bg-gray-50 opacity-75"}`,children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("h3",{className:"font-medium text-gray-900",children:e.productCode}),N&&t&&r.jsxs("span",{className:"px-2 py-1 text-xs font-medium bg-purple-100 text-purple-800 rounded",children:["#",t]}),r.jsxs("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded",children:["â‚¹",e.rate,"/kg"]}),r.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded ${_==="low"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:[e.quantity.toLocaleString(),"kg"]})]}),r.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[r.jsx("span",{className:"font-medium",children:e.company})," â€¢ ",e.grade]}),r.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[r.jsxs("span",{children:["Value: â‚¹",(e.quantity*e.rate).toLocaleString()]}),r.jsxs("span",{children:["Supplier: ",e.purchaseParty]}),r.jsxs("span",{children:["Added: ",e.dateAdded]})]}),!N&&i&&o>0&&r.jsxs("div",{className:"mt-2 text-xs text-blue-600",children:["Click to select ",b.toLocaleString(),"kg (",o>=e.quantity?"full amount":"remaining needed",")"]})]}),r.jsx("div",{className:"flex items-center gap-2 ml-4",children:N?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"number",value:f,onChange:O=>A(O.target.value),onBlur:S,onKeyPress:O=>O.key==="Enter"&&S(),className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0",max:e.quantity,step:"0.1"}),r.jsx("span",{className:"text-xs text-gray-500",children:"kg"}),r.jsx("button",{onClick:n,className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Remove selection",children:r.jsx(Gt,{className:"w-4 h-4"})})]}):r.jsxs("button",{onClick:n,disabled:!i,className:`flex items-center gap-1 px-3 py-1 text-sm rounded ${i?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[r.jsx(Ht,{className:"w-4 h-4"}),i?"Select":"Full"]})})]}),N&&r.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx(jt,{className:"w-4 h-4 text-green-600"}),r.jsxs("span",{className:"text-green-700 font-medium",children:["Selected ",s.toLocaleString(),"kg of ",e.quantity.toLocaleString(),"kg"]})]}),r.jsxs("div",{className:"text-sm text-gray-600",children:["â‚¹",(s*e.rate).toLocaleString()]})]})})]})}const ks=({value:e,onChange:s,error:t,className:i,placeholder:o="Enter additional number (optional)"})=>{const[n,d]=C.useState(!1),f=A=>{let S=A.target.value;S=S.replace(/[^\d\s\-\(\)\+]/g,""),S.length<=20&&s(S)};return r.jsxs(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:ie("space-y-2",i),children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Additional Notification",r.jsx("span",{className:"text-gray-500 text-xs ml-2",children:"(Optional)"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(Yt,{className:ie("h-5 w-5 transition-colors",n?"text-primary-500":"text-gray-400")})}),r.jsx("input",{type:"tel",value:e,onChange:f,onFocus:()=>d(!0),onBlur:()=>d(!1),placeholder:o,className:ie("block w-full pl-10 pr-3 py-2 border rounded-lg transition-all duration-200","focus:ring-2 focus:ring-primary-500 focus:border-primary-500","placeholder-gray-400 text-gray-900",t?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 hover:border-gray-400",n&&!t&&"border-primary-500 shadow-lg")})]}),r.jsx(Nt,{children:t&&r.jsxs(M.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center space-x-2 text-red-600 text-sm",children:[r.jsx(Re,{className:"h-4 w-4"}),r.jsx("span",{children:t})]})}),r.jsx("div",{className:"text-xs text-gray-500",children:"If provided, the boss notification will also be sent to this number"})]})},Fs=ks;class As{async sendNotification(s){try{if(!this.isValidPhoneNumber(s.phoneNumber))throw new Error("Invalid phone number format");const t=await fetch("/api/whatsapp/send-additional",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:s.phoneNumber,dealData:s.dealData})}),i=await t.json();if(!t.ok)throw new Error(i.message||"Failed to send notification");return{success:!0,phoneNumber:s.phoneNumber}}catch(t){return{success:!1,phoneNumber:s.phoneNumber,error:t instanceof Error?t.message:"Unknown error occurred"}}}isValidPhoneNumber(s){const t=s.replace(/\D/g,"");return t.length>=10&&t.length<=15}}const Vs=new As,_s=()=>{const[e,s]=C.useState(!1),[t,i]=C.useState(null),o=C.useCallback(async(d,f)=>{if(!(d!=null&&d.trim()))return null;s(!0),i(null);try{const A=await Vs.sendNotification({phoneNumber:d.trim(),dealData:f});return i(A),A}catch(A){const S={success:!1,phoneNumber:d.trim(),error:A instanceof Error?A.message:"Unknown error occurred"};return i(S),S}finally{s(!1)}},[]),n=C.useCallback(()=>{i(null)},[]);return{sendNotification:o,isLoading:e,result:t,clearResult:n}},Ds=_s,ze=(e=new Date)=>{const s=e.getDate().toString().padStart(2,"0"),t=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getFullYear();return`${s}-${t}-${i}`},Ps={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},xe={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{duration:.5}}};function Cs({onSuccess:e,onCancel:s}){var ve,Se,Pe;const[t,i]=C.useState(null),[o,n]=C.useState([]),[d,f]=C.useState([]),[A,S]=C.useState([]),[N,_]=C.useState(!0),[b,O]=C.useState([]),[Q,P]=C.useState(!1),[U,le]=C.useState(""),{createDeal:F,creating:z}=Ut(),{sendNotification:$}=Ds(),{register:y,handleSubmit:D,watch:h,setValue:k,formState:{errors:w},reset:I}=vs({defaultValues:{date:ze(),deliveryTerms:"delivered",saleSource:"new"}}),T=h("productCode"),v=h("saleSource");C.useEffect(()=>{(async()=>{try{_(!0);const[G,X,te]=await Promise.all([nt.getCustomers(),nt.getSuppliers(),js.getProducts()]);G.success&&n(G.data||[]),X.success&&f(X.data||[]),te.success&&S(te.data||[])}catch(G){console.error("Failed to load initial data:",G),je.error("Failed to load form data. Please refresh the page.")}finally{_(!1)}})()},[]),C.useEffect(()=>{if(T){const j=A.find(G=>G.productCode===T);i(j),j&&V(j)}else i(null),P(!1)},[T,A]);const V=async j=>{try{const G=`/api/inventory/available/${encodeURIComponent(j.productCode)}/${encodeURIComponent(j.grade)}/${encodeURIComponent(j.company)}/${encodeURIComponent(j.specificGrade)}`;console.log("Checking inventory availability for:",G);const X=await fetch(G);if(X.ok){const te=await X.json();console.log("Inventory check result:",te),P(te.success&&te.data&&te.data.length>0)}else console.error("Inventory check failed with status:",X.status),P(!1)}catch(G){console.error("Failed to check inventory availability:",G),P(!1)}},q=j=>{O(j)},K=j=>{j&&k("productCode",j.productCode)},J=async j=>{try{const G=j.date.includes("-")&&j.date.length===10&&j.date.charAt(4)==="-"?j.date.split("-").reverse().join("-"):j.date,X={...j,date:G,quantitySold:Number(j.quantitySold),saleRate:Number(j.saleRate),purchaseQuantity:Number(j.purchaseQuantity),purchaseRate:Number(j.purchaseRate)};t&&(X.grade=t.grade,X.company=t.company,X.specificGrade=t.specificGrade),j.saleSource==="inventory"&&b.length>0&&(X.selectedInventoryItems=b);const te=await F(X);if(te){let ue="Deal registered successfully! WhatsApp notifications sent.";if(U.trim()){const he=await $(U,te);he&&!he.success?je.success(`${ue}
âš ï¸ Additional notification failed: ${he.error}`,{duration:6e3}):he&&he.success?(ue+=` Additional notification sent to ${U}.`,je.success(ue)):je.success(ue)}else je.success(ue);I({date:ze(),deliveryTerms:"delivered",saleSource:"new"}),O([]),i(null),P(!1),le(""),e&&e(te)}}catch(G){je.error(G.message||"Failed to register deal. Please try again."),console.error("Error registering deal:",G)}};if(N)return r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx(ct,{className:"w-8 h-8 animate-spin text-primary-600"}),r.jsx("span",{className:"ml-2 text-gray-600",children:"Loading form data..."})]});const re=o.map(j=>({value:j.partyName,label:j.partyName})),pe=d.map(j=>({value:j.partyName,label:j.partyName})),me=bs(A);return r.jsxs(M.div,{variants:Ps,initial:"hidden",animate:"visible",className:"max-w-4xl mx-auto w-full px-4",children:[r.jsxs(M.div,{variants:xe,className:"mb-8",children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[r.jsx(Ie,{className:"w-8 h-8 mr-3 text-primary-600"}),"Register New Deal"]}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Process a new polymer trading transaction with automatic WhatsApp notifications"})]}),r.jsxs("form",{onSubmit:D(J),className:"space-y-8",children:[r.jsxs(M.div,{variants:xe,className:"card",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx(Wt,{className:"w-5 h-5 text-primary-600 mr-2"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Basic Deal Information"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Date ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",...y("date",{required:"Date is required"}),className:ie("input-field",w.date&&"border-red-500"),placeholder:"dd/mm/yyyy"}),w.date&&r.jsx("p",{className:"error-message",children:w.date.message})]}),r.jsx(We,{label:"Sale Party (Customer)",required:!0,options:re.map(j=>({value:j.value,label:j.label,searchableFields:{}})),value:h("saleParty")||"",onChange:j=>k("saleParty",j),placeholder:"Search customer...",error:(ve=w.saleParty)==null?void 0:ve.message}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Quantity Sold (kg) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",step:"0.01",...y("quantitySold",{required:"Quantity is required",min:{value:.01,message:"Quantity must be greater than 0"}}),className:ie("input-field",w.quantitySold&&"border-red-500"),placeholder:"Enter quantity in kg"}),w.quantitySold&&r.jsx("p",{className:"error-message",children:w.quantitySold.message})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Sale Rate (â‚¹/kg) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",step:"0.01",...y("saleRate",{required:"Sale rate is required",min:{value:.01,message:"Rate must be greater than 0"}}),className:ie("input-field",w.saleRate&&"border-red-500"),placeholder:"Enter rate per kg"}),w.saleRate&&r.jsx("p",{className:"error-message",children:w.saleRate.message})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Delivery Terms ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"flex space-x-4",children:[r.jsxs(M.label,{className:"flex items-center cursor-pointer",whileHover:{scale:1.02},whileTap:{scale:.98},children:[r.jsx("input",{type:"radio",value:"delivered",...y("deliveryTerms"),className:"w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500"}),r.jsx("span",{className:"ml-2 text-gray-700",children:"Delivered"})]}),r.jsxs(M.label,{className:"flex items-center cursor-pointer",whileHover:{scale:1.02},whileTap:{scale:.98},children:[r.jsx("input",{type:"radio",value:"pickup",...y("deliveryTerms"),className:"w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500"}),r.jsx("span",{className:"ml-2 text-gray-700",children:"Ex-Warehouse (Pickup)"})]})]})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sale Comments"}),r.jsx("textarea",{...y("saleComments"),rows:3,className:"input-field resize-none",placeholder:"Additional notes about the sale..."})]})]})]}),r.jsxs(M.div,{variants:xe,className:"card",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx(Ie,{className:"w-5 h-5 text-primary-600 mr-2"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Product Information"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsx("div",{className:"md:col-span-2",children:r.jsx(We,{label:"Product Code",required:!0,options:me,value:T||"",onChange:j=>k("productCode",j),placeholder:"Search by product code, grade, company, or specific grade...",error:(Se=w.productCode)==null?void 0:Se.message})}),t&&r.jsxs(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"md:col-span-2 bg-primary-50 p-4 rounded-xl border border-primary-200",children:[r.jsx("h3",{className:"font-medium text-primary-900 mb-2",children:"Product Details"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-primary-600 font-medium",children:"Grade:"}),r.jsx("p",{className:"text-primary-800",children:t.grade})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-primary-600 font-medium",children:"Company:"}),r.jsx("p",{className:"text-primary-800",children:t.company})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-primary-600 font-medium",children:"Specific Grade:"}),r.jsx("p",{className:"text-primary-800",children:t.specificGrade})]})]})]})]})]}),r.jsxs(M.div,{variants:xe,className:"card",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx(Kt,{className:"w-5 h-5 text-primary-600 mr-2"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Material Source"})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Sale Source ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"flex space-x-4",children:[r.jsxs(M.label,{className:"flex items-center cursor-pointer",whileHover:{scale:1.02},whileTap:{scale:.98},children:[r.jsx("input",{type:"radio",value:"new",...y("saleSource"),className:"w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500"}),r.jsx("span",{className:"ml-2 text-gray-700",children:"New Material"})]}),r.jsxs(M.label,{className:"flex items-center cursor-pointer",whileHover:{scale:1.02},whileTap:{scale:.98},children:[r.jsx("input",{type:"radio",value:"inventory",...y("saleSource"),className:"w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500"}),r.jsx("span",{className:"ml-2 text-gray-700",children:"From Inventory"})]})]})]}),v==="inventory"&&r.jsx(M.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-4",children:t&&Q?r.jsx(ws,{productCode:t.productCode||"",grade:t.grade||"",company:t.company||"",specificGrade:t.specificGrade||"",requiredQuantity:h("quantitySold")?Number(h("quantitySold")):0,onSelectionChange:q,onProductAutoFill:K}):t&&!Q?r.jsx("div",{className:"bg-orange-50 p-4 rounded-xl border border-orange-200",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Re,{className:"w-5 h-5 text-orange-600 mr-2"}),r.jsx("p",{className:"text-orange-800",children:'No inventory available for this product. Please use "New Material" option.'})]})}):r.jsx("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-200",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Re,{className:"w-5 h-5 text-blue-600 mr-2"}),r.jsx("p",{className:"text-blue-800",children:"Please select a product first to see available inventory."})]})})})]})]}),v==="new"&&r.jsxs(M.div,{variants:xe,className:"card",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3},children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx(Qt,{className:"w-5 h-5 text-primary-600 mr-2"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Purchase Details"})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{children:r.jsx(We,{label:"Purchase Party (Supplier)",required:!0,options:pe.map(j=>({value:j.value,label:j.label,searchableFields:{}})),value:h("purchaseParty")||"",onChange:j=>k("purchaseParty",j),placeholder:"Search supplier...",error:(Pe=w.purchaseParty)==null?void 0:Pe.message})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Purchase Quantity (kg) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",step:"0.01",...y("purchaseQuantity",{required:"Purchase quantity is required",min:{value:.01,message:"Quantity must be greater than 0"}}),className:ie("input-field",w.purchaseQuantity&&"border-red-500"),placeholder:"Enter quantity in kg"}),w.purchaseQuantity&&r.jsx("p",{className:"error-message",children:w.purchaseQuantity.message})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Purchase Rate (â‚¹/kg) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"number",step:"0.01",...y("purchaseRate",{required:"Purchase rate is required",min:{value:.01,message:"Rate must be greater than 0"}}),className:ie("input-field",w.purchaseRate&&"border-red-500"),placeholder:"Enter rate per kg"}),w.purchaseRate&&r.jsx("p",{className:"error-message",children:w.purchaseRate.message})]})]}),r.jsxs("div",{className:"pb-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warehouse Location"}),r.jsx("input",{type:"text",...y("warehouse"),className:"input-field w-full",placeholder:"Enter warehouse location"})]})]})]}),r.jsxs(M.div,{variants:xe,className:"card",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx(zt,{className:"w-5 h-5 text-primary-600 mr-2"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Comments"})]}),r.jsxs("div",{className:"space-y-4",children:[v==="new"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Purchase Comments"}),r.jsx("textarea",{...y("purchaseComments"),rows:3,className:"input-field resize-none",placeholder:"Additional notes about the purchase..."})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Final Comments"}),r.jsx("textarea",{...y("finalComments"),rows:3,className:"input-field resize-none",placeholder:"Any final notes or instructions..."})]})]})]}),r.jsx(M.div,{variants:xe,children:r.jsx(Fs,{value:U,onChange:le,placeholder:"Enter phone number for additional notification (optional)"})}),r.jsxs(M.div,{variants:xe,className:"flex justify-end space-x-4",children:[s&&r.jsx(M.button,{type:"button",className:"btn-secondary",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:s,children:"Cancel"}),r.jsx(M.button,{type:"button",className:"btn-secondary",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{I({date:ze(),deliveryTerms:"delivered",saleSource:"new"}),i(null),le("")},children:"Reset Form"}),r.jsx(M.button,{type:"submit",disabled:z,className:ie("btn-primary flex items-center space-x-2",z&&"opacity-50 cursor-not-allowed"),whileHover:z?{}:{scale:1.02},whileTap:z?{}:{scale:.98},children:z?r.jsxs(r.Fragment,{children:[r.jsx(ct,{className:"w-5 h-5 animate-spin"}),r.jsx("span",{children:"Processing..."})]}):r.jsxs(r.Fragment,{children:[r.jsx($t,{className:"w-5 h-5"}),r.jsx("span",{children:"Register Deal"})]})})]})]})]})}function Us(){return r.jsx(qt,{children:r.jsx(Cs,{})})}export{Us as default};
